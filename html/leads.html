<!DOCTYPE html>
<style>

</style>
<html>

<head>
    <title>
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="col-sm-12" style="text-align:right">
            <img src="/uploads/logol.jpg" style="float:left;height:60px;width:300px;margin-left:-60px" />

            <div id="logout">
                <br>

            </div>
        </div>
    </div>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">

            <ul class="nav navbar-nav">
                <li><a href="/html/dashboard.html">Dashboard</a></li>
                <li class="active"><a href="/html/leads.html">Leads</a></li>
                <li><a href="#">Create New Enquiry</a></li>
                <li><a href="/html/prospect.html">Prospects</a></li>
                <li><a href="/html/payment.html">Payment</a></li>
                <li><a href="#">Query</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h4 style="text-decoration:underline;text-align:center"><b>My Leads</b></h4>
        <div style="height:435px;overflow:auto;background-color: aliceblue">
            <table class="table table-condensed">

                <thead style="background-color:darkgrey">
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Contact no.</th>
                        <th>Stage</th>
                    </tr>
                </thead>
                <tbody id='leads'>

                </tbody>

            </table>
        </div>
    </div>

</body>

</html>
<script>
    function viewleads() {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState === XMLHttpRequest.DONE) {

                if (request.status === 200) {

                    var content = '';
                    var data = JSON.parse(this.responseText);
                    var i = 0;
                    console.log(data.length);
                    for (; i < data.length; i++) {
                        if (data[i].stage === 0) {
                            content += `<tr><td><button style="border-color:slategrey;border-radius:25px;background-color:white"><a href="profile.html" rel="popover" data-popover-content="#viewprofile">${data[i].profile_id}</button></a></td><td>${data[i].person_of_contact}</td><td>${data[i].mobile_no}<td>Lead</td></tr>`;
                        }
                    }
                    document.getElementById('leads').innerHTML = content;

                } else if (request.status === 403) {
                    alert('something went wrong on the server');
                } else if (request.status === 500) {
                    alert('Something went wrong on the server');

                } else {

                    alert('Something went wrong');

                }
            }
        };
        request.open('GET', '/viewallleads', true);
        request.send(null);

    }

    function loadLoggedInUser(username) {

        document.getElementById("logout").innerHTML = `<p>Hi,${username}</p><a href="/logout">Logout</a>`;
        viewleads();
    }

    function loadLogin() {
        // Check if the user is already logged in
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState === XMLHttpRequest.DONE) {
                if (request.status === 200) {
                    loadLoggedInUser(this.responseText);

                }

            }
        };

        request.open('GET', '/check-login', true);
        request.send(null);
    }
    loadLogin();
    //viewleads();
</script>